# README.md

# Stylus Hello World Template

This repository serves as a beginner-friendly starter kit for developing Arbitrum Stylus smart contracts in Rust, powered by the stylus-sdk. It features a simple Rust-based implementation of a counter contract that mirrors this Solidity counterpart:

```solidity
// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

contract Counter {
    uint256 public number;

    function setNumber(uint256 newNumber) public {
        number = newNumber;
    }

    function increment() public {
        number++;
    }
}
```

This template is configured to easily generate the necessary Solidity ABI for interacting with your Rust contract.

## Getting Started

### Prerequisites

- Rust toolchain
- VS Code
- Docker
- Foundry's cast
- Nitro devnode

### Installation

1. Install the Stylus CLI:

```bash
cargo install --force cargo-stylus
```

2. Enable WebAssembly compilation:

```bash
rustup default 1.80
rustup target add wasm32-unknown-unknown --toolchain 1.80
```

3. Verify installation:

```bash
cargo stylus --help
```

4. Clone this repository:

```bash
git clone https://github.com/OffchainLabs/stylus-hello-world && cd stylus-hello-world
```

## Testnet Details

Find all necessary testnet resources—faucets, RPC URLs, etc.—[here](https://docs.arbitrum.io/stylus/reference/testnet-information).

## Contract Validation

Before deploying, validate your contract can be deployed and activated onchain:

```bash
cargo stylus check
```

Docker must be running for this command.

Example successful output:

```
Finished release [optimized] target(s) in 1.88s
Reading WASM file at stylus-hello-world/target/wasm32-unknown-unknown/release/stylus-hello-world.wasm
Compressed WASM size: 8.9 KB
Program succeeded Stylus onchain activation checks with Stylus version: 1
```

## Contract Deployment

### 1. Estimate Gas (without transaction)

```bash
cargo stylus deploy \
  --private-key-path=<PRIVKEY_FILE_PATH> \
  --estimate-gas
```

Example output:

```
Estimated gas for deployment: 1874876
```

### 2. Deploy Contract

```bash
cargo stylus deploy \
  --private-key-path=<PRIVKEY_FILE_PATH>
```

Successful output:

```
Compressed WASM size: 8.9 KB
Deploying program to address 0x457b1ba688e9854bdbed2f473f7510c476a3da09
Estimated gas: 1973450
Submitting tx...
Confirmed tx 0x42db…7311, gas used 1973450
Activating program at address 0x457b1ba688e9854bdbed2f473f7510c476a3da09
Estimated gas: 14044638
Submitting tx...
Confirmed tx 0x0bdb…3307, gas used 14044638
```

Your contract is now deployed and activated!

## ABI Generation

Generate the Solidity ABI for your contract:

```bash
cargo stylus export-abi
```

This will output:

```solidity
/**
 * This file was automatically generated by Stylus and represents a Rust program.
 * For more information, please see [The Stylus SDK](https://github.com/OffchainLabs/stylus-sdk-rs).
 */

// SPDX-License-Identifier: MIT-OR-APACHE-2.0
pragma solidity ^0.8.23;

interface ICounter {
    function number() external view returns (uint256);

    function setNumber(uint256 new_number) external;

    function mulNumber(uint256 new_number) external;

    function addNumber(uint256 new_number) external;

    function increment() external;
}
```

## Interacting with the Contract

### Rust Interaction Example

See `examples/counter.rs` for a complete example using ethers-rs:

```rust
abigen!(
    Counter,
    r#"[
        function number() external view returns (uint256)
        function setNumber(uint256 number) external
        function increment() external
    ]"#
);

// Configure environment with:
// RPC_URL, STYLUS_CONTRACT_ADDRESS, PRIV_KEY_PATH
// in a .env file or environment variables

let provider = alchemy_provider(&rpc_url).await?;
let client = LocalWallet::from_str(&priv_key, &provider.clone())?;
let counter = Counter::new(counter_address, &provider.into());

// Read current value
let current_value = counter.number().call().await?;
println!("Current counter value: {:?}", current_value);

// Update counter value
let _ = counter.increment().send().await?.await?;
let new_value = counter.number().call().await?;
println!("New counter value: {:?}", new_value);
```

Run with:

```bash
cargo run --example counter
```

### Foundry's Cast

#### Calling a Function

```bash
cast call \
  --rpc-url <RPC_URL> \
  --private-key <PRIVATE_KEY> \
  [contract-address] "number()(uint256)"
```

Example output:

```
0
```

#### Sending a Transaction

```bash
cast send \
  --rpc-url <RPC_URL> \
  --private-key <PRIVATE_KEY> \
  [contract-address] "increment()"
```

After incrementing, you can call the number() function again to see the updated value.

## Testing

The template includes a test file (`tests/test_counter.rs`) that demonstrates how to test your Stylus contract:

```rust
#[cfg(test)]
mod test {
    use super::*;
    use alloy_primitives::address;
    use stylus_sdk::testing::*;

    #[test]
    fn test_counter_operations() {
        let vm = TestVM::default();
        let mut contract = Counter::from(&vm);

        assert_eq!(contract.number().unwrap(), U256::ZERO);

        contract.increment().unwrap();
        assert_eq!(contract.number().unwrap(), U256::from(1));

        contract.set_number(U256::from(5)).unwrap();
        assert_eq!(contract.number().unwrap(), U256::from(5));
    }
}
```

Run tests with:

```bash
cargo test
```

## Customization Options

- Add dependencies in `Cargo.toml` for advanced features
- Use `cargo stylus new --minimal` for a leaner setup
- For advanced wasm optimization, consult [cargo-stylus documentation](https://github.com/OffchainLabs/cargo-stylus)
