# Stylus Hello World Template

This repository serves as a beginner-friendly starter kit for developing Arbitrum Stylus smart contracts in Rust, powered by the stylus-sdk. It features a simple Rust-based implementation mirroring this Solidity counter contract:

```solidity
// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

contract Counter {
    uint256 public number;

    function setNumber(uint256 newNumber) public {
        number = newNumber;
    }

    function increment() public {
        number++;
    }
}
```

For a leaner setup while keeping the Stylus SDK, run `cargo stylus new --minimal <YOUR_PROJECT_NAME>` from the OffchainLabs/cargo-stylus repo.

## Getting Started Quickly

Ensure Rust is installed, then set up the Stylus CLI via Cargo:

```bash
cargo install --force cargo-stylus cargo-stylus-check
```

Enable WebAssembly compilation by adding the target:

```bash
rustup target add wasm32-unknown-unknown
```

Verify the installation:

```bash
cargo stylus --help
```

Grab the template:

```bash
git clone https://github.com/OffchainLabs/stylus-hello-world && cd stylus-hello-world
```

## Testnet Details

Find all necessary testnet resources—faucets, RPC URLs, etc.—[here](https://docs.arbitrum.io/stylus/reference/testnet-information).

## Generating ABI

Use the CLI to produce a Solidity ABI for your Rust code:

```bash
cargo stylus export-abi
```

This generates something like:

```solidity
/**
 * This file was automatically generated by Stylus and represents a Rust program.
 * For more information, please see [The Stylus SDK](https://github.com/OffchainLabs/stylus-sdk-rs).
 */

// SPDX-License-Identifier: MIT-OR-APACHE-2.0
pragma solidity ^0.8.23;

interface ICounter {
    function number() external view returns (uint256);

    function setNumber(uint256 new_number) external;

    function mulNumber(uint256 new_number) external;

    function addNumber(uint256 new_number) external;

    function increment() external;
}
```

The `export-abi` feature is pre-enabled in `Cargo.toml`:

```toml
[features]
export-abi = ["stylus-sdk/export-abi"]
```

## Deployment Process

Deploy to the Stylus testnet using `cargo stylus`. Start by verifying WASM compilation and on-chain compatibility (uses default testnet RPC; check [testnet docs](https://docs.arbitrum.io/stylus/reference/testnet-information)):

```bash
cargo stylus check
```

Success looks like:

```
Finished release [optimized] target(s) in 1.88s
Reading WASM file at stylus-hello-world/target/wasm32-unknown-unknown/release/stylus-hello-world.wasm
Compressed WASM size: 8.9 KB
Program succeeded Stylus onchain activation checks with Stylus version: 1
```

Estimate gas for deployment/activation without committing (see wallet options in [cargo-stylus README](https://github.com/OffchainLabs/cargo-stylus/blob/main/README.md)):

```bash
cargo stylus deploy \
  --private-key-path=<PRIVKEY_FILE_PATH> \
  --estimate-gas
```

Example output:

```
Deploying program to address e43a32b54e48c7ec0d3d9ed2d628783c23d65020
Estimated gas for deployment: 1874876
```

For activation gas estimates: Deploy with `--mode=deploy-only`, then estimate using `--mode=activate-only --activate-program-address --estimate-gas`.

To deploy fully:

```bash
cargo stylus deploy \
  --private-key-path=<PRIVKEY_FILE_PATH>
```

It executes deployment and activation transactions:

```
Compressed WASM size: 8.9 KB
Deploying program to address 0x457b1ba688e9854bdbed2f473f7510c476a3da09
Estimated gas: 1973450
Submitting tx...
Confirmed tx 0x42db…7311, gas used 1973450
Activating program at address 0x457b1ba688e9854bdbed2f473f7510c476a3da09
Estimated gas: 14044638
Submitting tx...
Confirmed tx 0x0bdb…3307, gas used 14044638
```

Your program is now live and interactable like any Ethereum contract.

## Interacting with the Program

The `examples/counter.rs` file demonstrates Rust interactions via [ethers-rs](https://github.com/gakonst/ethers-rs). Stylus SDK ensures ABI compatibility with standard Ethereum tools.

Example code to read and update the counter:

```rust
abigen!(
    Counter,
    r#"[
        function number() external view returns (uint256)
        function setNumber(uint256 number) external
        function increment() external
    ]"#
);
let counter = Counter::new(address, client);
let num = counter.number().call().await;
println!("Counter number value = {:?}", num);

let _ = counter.increment().send().await?.await?;
println!("Successfully incremented counter via a tx");

let num = counter.number().call().await;
println!("New counter number value = {:?}", num);
```

Set up environment variables or a `.env` file (based on `.env.example`):

```
RPC_URL=https://sepolia-rollup.arbitrum.io/rpc
STYLUS_CONTRACT_ADDRESS=<the onchain address of your deployed program>
PRIV_KEY_PATH=<the file path for your priv key to transact with>
```

Run the example:

```bash
cargo run --example counter --target=<YOUR_ARCHITECTURE>
```

Determine `<YOUR_ARCHITECTURE>` with `rustc -vV | grep host` (e.g., `aarch64-apple-darwin` for M1 Macs, `x86_64-unknown-linux-gnu` for x86 Linux).

## Customization Options

`cargo stylus` applies default WASM optimizations. For advanced control, consult the [cargo stylus README](https://github.com/OffchainLabs/cargo-stylus). To minimize WASM size, refer to [optimization tips](https://github.com/OffchainLabs/cargo-stylus/blob/main/OPTIMIZING_BINARIES.md).

## Exploring the Internals

The stylus-sdk offers robust tools for Rust-based Stylus development, including macros that simplify Solidity transitions by expanding to plain Rust for WASM compilation. View the expanded boilerplate code with `cargo expand`:

First, install if needed:

```bash
cargo install cargo-expand
```

Then:

```bash
cargo expand --all-features --release --target=<YOUR_ARCHITECTURE>
```

Use the architecture from earlier.

## Licensing

Licensed openly under Apache-2.0 or MIT—choose your preference, with your own copyright notice.
