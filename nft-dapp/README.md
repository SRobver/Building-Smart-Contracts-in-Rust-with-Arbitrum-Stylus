# Stylus NFT Template

This repository serves as a beginner-friendly starter kit for developing Arbitrum Stylus smart contracts in Rust, powered by the stylus-sdk. It features a Rust-based implementation of an ERC-721 NFT contract called "CandyNFT" (üç¨), implementing mint, transfer, and approval functionality.

This template is configured to easily generate the necessary Solidity ABI for interacting with your Rust contract.

## Getting Started

### Prerequisites

- Rust toolchain
- VS Code
- Docker
- Foundry's cast
- Nitro devnode

### Installation

1. Install the Stylus CLI:

```bash
cargo install --force cargo-stylus
```

2. Enable WebAssembly compilation:

```bash
rustup default 1.80
rustup target add wasm32-unknown-unknown --toolchain 1.80
```

3. Verify installation:

```bash
cargo stylus --help
```

4. Clone the main repository:

```bash
git clone https://github.com/SRobver/Building-Smart-Contracts-in-Rust-with-Arbitrum-Stylus.git && cd nft-dapp
```

## Testnet Details

Find all necessary testnet resources‚Äîfaucets, RPC URLs, etc.‚Äî[here](https://docs.arbitrum.io/stylus/reference/testnet-information).

## Contract Validation

Before deploying, validate your contract can be deployed and activated onchain:

```bash
cargo stylus check
```

Docker must be running for this command.

Example successful output:

```
Finished release [optimized] target(s) in 1.88s
Reading WASM file at nft-dapp/target/wasm32-unknown-unknown/release/nft_dapp.wasm
Compressed WASM size: XX KB
Program succeeded Stylus onchain activation checks with Stylus version: 1
```

## Contract Deployment

### 1. Estimate Gas (without transaction)

```bash
cargo stylus deploy \
  --private-key-path=<PRIVKEY_FILE_PATH> \
  --estimate-gas
```

Example output:

```
Estimated gas for deployment: 1973450
```

### 2. Deploy Contract

```bash
cargo stylus deploy \
  --private-key-path=<PRIVKEY_FILE_PATH>
```

Successful output:

```
Compressed WASM size: XX KB
Deploying program to address 0x457b1ba688e9854bdbed2f473f7510c476a3da09
Estimated gas: 1973450
Submitting tx...
Confirmed tx 0x42db‚Ä¶7311, gas used 1973450
Activating program at address 0x457b1ba688e9854bdbed2f473f7510c476a3da09
Estimated gas: 14044638
Submitting tx...
Confirmed tx 0x0bdb‚Ä¶3307, gas used 14044638
```

Your contract is now deployed and activated!

## ABI Generation

Generate the Solidity ABI for your contract:

```bash
cargo stylus export-abi
```

This will output:

```solidity
/**
 * This file was automatically generated by Stylus and represents a Rust program.
 * For more information, please see [The Stylus SDK](https://github.com/OffchainLabs/stylus-sdk-rs).
 */

// SPDX-License-Identifier: MIT-OR-APACHE-2.0
pragma solidity ^0.8.23;

interface ICandyNFT {
    function name() external view returns (string memory);
    function symbol() external view returns (string memory);
    function ownerOf(uint256 tokenId) external view returns (address);
    function balanceOf(address owner) external view returns (uint256);
    function mint(address to, uint256 tokenId) external;
    function transferFrom(address from, address to, uint256 tokenId) external;
    function approve(address spender, uint256 tokenId) external;
}
```

## Interacting with the Contract

### Rust Interaction Example

See `examples/nft.rs` for a complete example using ethers-rs:

```rust
abigen!(
    CandyNFT,
    r#"[
        function name() external view returns (string memory)
        function symbol() external view returns (string memory)
        function ownerOf(uint256 tokenId) external view returns (address)
        function balanceOf(address owner) external view returns (uint256)
        function mint(address to, uint256 tokenId) external
        function transferFrom(address from, address to, uint256 tokenId) external
        function approve(address spender, uint256 tokenId) external
    ]"#
);

// Configure environment with:
// RPC_URL, STYLUS_CONTRACT_ADDRESS, PRIV_KEY_PATH
// in a .env file or environment variables

let provider = alchemy_provider(&rpc_url).await?;
let client = LocalWallet::from_str(&priv_key, &provider.clone())?;
let nft = CandyNFT::new(nft_address, &provider.into());

// Read NFT metadata
let name = nft.name().call().await?;
println!("NFT name: {}", name);

// Mint an NFT
let token_id = U256::from(1);
let _ = nft.mint(client.address(), token_id).send().await?.await?;
println!("Minted token {}", token_id);

// Check ownership
let owner = nft.owner_of(token_id).call().await?;
println!("Owner of token {}: {:?}", token_id, owner);
```

Run with:

```bash
cargo run --example nft
```

### Foundry's Cast

#### Calling a Function

```bash
cast call \
  --rpc-url <RPC_URL> \
  --private-key <PRIVATE_KEY> \
  [contract-address] "name()(string)"
```

Example output:

```
CandyNFT
```

#### Sending a Transaction (Mint NFT)

```bash
cast send \
  --rpc-url <RPC_URL> \
  --private-key <PRIVATE_KEY> \
  [contract-address] "mint(address,uint256)" <YOUR_ADDRESS> 1
```

After minting, you can call functions like balanceOf or ownerOf to verify.

## Testing

The template includes test files that demonstrate how to test your Stylus NFT contract:

Run tests with:

```bash
cargo test
```

## Customization Options

- Add dependencies in `Cargo.toml` for advanced features
- Use `cargo stylus new --minimal` for a leaner setup
